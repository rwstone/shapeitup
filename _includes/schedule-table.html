{% comment %}
Classes can span multiple time blocks within the calendar. For example, a 1-hour class spans two blocks on a calendar broken down into 30-minute segments. "this_row_blocked" is an array with one entry per day. A value greater than zero indicates that there is a class continuing into the current time block, which started earlier. The number gives how many more blocks to complete the class length.
{% endcomment %}
{% assign this_row_blocked = "" | split: "" %}
{% for i in (1..include.days.size) %}
    {% assign this_row_blocked = this_row_blocked | push: 0 %}
{% endfor %}
    
{% for time in include.time_slots %}
    {% unless forloop.last == true %}
        {% assign next_row_blocked = "" | split: "" %}
        <tr{% cycle ' class="row_gray"', ' class="row_gray"', '', '' %}>
            <td>
                {{ time | escape }} - {{ include.time_slots[forloop.index] | escape }}
            </td>
            {% for day in include.days %}
                {% assign filtered_sessions = include.sessions | where:"day",day | where:"start_time",time %}
                {% assign tmp_blocked = this_row_blocked | first %}
                {% assign this_row_blocked = this_row_blocked | shift %}
                {% if filtered_sessions == empty %}
                    {% if tmp_blocked > 0 %}
                        {% assign tmp_blocked_after = tmp_blocked | minus: 1 %}
                    {% else %}
                        {% assign tmp_blocked_after = 0 %}
                        <td></td>
                    {% endif %}
                {% else %}
                    {% assign current_session = filtered_sessions | first %}
                    {% assign tmp_blocked_after = current_session.length | default: 2 | minus: 1 %}
					{% comment %}
                        Added downcase filter to force string conversion on Windows, jekyll 3.5.2, 8/16/2017
					{% endcomment %}
                    <td rowspan="{{ current_session.length | default: 2 | downcase | escape }}" class="event">
                        {% comment %}
                            20180112: Links now point to MindBody instead of the class descriptions on the Fitness page
                            Original code:
                                <a href="/fitness#gallery-details-{{ current_session.class | slugify }}">{{ current_session.class | escape }}</a>
                        {% endcomment %}
                        {% include schedule-links.html class_name=current_session.class %}
                        <div>{{ current_session.instructor | escape }}</div>
                        <div>{{ current_session.start_time | escape }} - {{ current_session.end_time | escape }}</div>
                    </td>
                {% endif %}
                {% assign next_row_blocked = next_row_blocked | push: tmp_blocked_after %}
            {% endfor %}
        </tr>
        {% assign this_row_blocked = next_row_blocked %}
    {% endunless %}
{% endfor %}